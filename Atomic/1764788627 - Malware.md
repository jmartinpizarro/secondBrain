---
aliases:
  - Malware
tags:
"References":
cssclasses:
---
# Malware

**Malware**: código que puede poner al usuario, sus datos o su máquina en riesgo.

- Compromete la integridad de la máquina
- Gana control sobre la máquina
- Permite usar operaciones remotas al atacante para acceder, usar o explotar un dispositivo.
- Transmite datos privados del usuario sin su consentimiento

## Malware análisis

El proceso de diseccionar un malware para entender cómo funciona y aprender a cómo identificarlo y/o eliminarlo.

Parte de una incidencia inicial, busca medir, contener y recuperarse del daño.

Tras el análisis se pueden obtener contenidos que ayuden a mejorar las defensas:
- Detection signatures
- Indicadores de compromiso
- Patrones, comportamientos, analíticas internas de la máquina...

**Técnicas de análisis**
- Estáticas:
	- **Básica**: analizar los metadatos y otros artefactos del binario, nunca el código
	- **Avanzada**: descomponer el código y hacer ingeniería reversa
- Dinámicas
	- **Básica**: ejecutar y ver las trazas de ejecución que afectan al sistema (y cómo interactúa con otros sistemas)
	- **Avanzada**: ejecutar de manera controlada para analizar el estado interno del programa

### Detección de Malware

**Scanners**:
- Señales basadas en el host
- Señales basadas en la red (en especial en el tráfico de red)
**Máquinas heurísticas**
- Estático
- Dinámico
- Híbrido


## Downloaders, droppers and loaders

Download || drop y luego ejecutar en otro lugar. Es una estrategia común en los últimos tiempos.

*Un maldoc (Wordfile) contiene macros al abrirse. Invoca un proceso WMI y ejecuta una powershell que descarga un binario de alguna url*.

Los *loaders* se encargan de ejecutar el binario en algún momento.

## Rootkits

Herramientas pos-explotación usadas para conseguir persistencia y evadir defensas. Consiguen invisibilidad a nivel de archivo, proceso y red.

Pueden hacer bypass de autenticación

**Tipos**:
- User Mode (Ring 3)
- Kernel Mode (Ring 0)
- Hypervisor (Ring -1)
- Firmware and hardware (Ring -2) (BIOS, UEFI)

## Hooking

Redirigir el flujo de ejecución de una función a un bloque de código controlado, usualmente siendo una librería importante o una API/syscall.

Significa que puedes:
- Llamar a una función en vez de a la original
- Llamar a la original pero cambiar ciertas partes de su código

### System calls

Es un mecanismo que pide servicios del kernel del sistema operativo. El *libc* (Linux) es la interfaz entre el *userland* y el *kernel-land*. Si se modifica, *printf()* puede que invoque a *write()*. Esto se llama instrucción-trampa.

Como resultado, la CPU cambia a modo supervisor y ejecuta en el kernel. Se puede pensar como
- read(), readv(), pread(): obtener input
- write(), writev(): obtener output
- kill(): prevenir envío de señales...

## Backdoors, RATs, Boot(net)s

### Backdooring

Busca proveer al atacante una puerta de entrada a un sistema haciendo bypass de los controles de seguridad.
- Shells reversas: fáciles de usar y de generar si el sistema no está correctamente defendido (pipes, sockets, 2 threads)
- Trojans/herramientas que permiten administración remota
- Bots aceptando instrucciones predefinidas

### RATs

Herramientas legítimas que sirven para hacer *scam* (los indios). Interactivos atacante - usuario.

### Botnets

El botnet hace ataques en masa mientras que los RATs son ataques seleccionados (a ancianos por ejemplo).

## Worms

Programa que se replica a sí mismo propagándose por otros computadores.

Una vez que un host está infectado, se escanea e infecta a otros a través de la red (usualmente por vulnerabilidades entre hosts de comunicación). Crecimiento exponencial.

Tiene varias partes:
- Reconocimiento: identificar a la meta a través del scanning o con tecnologías más pasivas como el análisis de tráfico.
- Infección: local y remota (en la propagación de la nueva meta). Se ejecuta con RCE (0 clicks) o por configuraciones no-óptimas. Phising.
- Propagación:
	- Central: host del worm. El código se obtiene de dicho repo.
	- Back-chaining: se transfiere el código del worm de un host en otro
	- Propagación autónoma: no hay transferencia de ficheros. El código se encuentra en la carga

**Usualmente todos tienen una backdoor** que da acceso al operador u otras instancias del worm.